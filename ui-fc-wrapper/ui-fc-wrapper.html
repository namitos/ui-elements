<link rel="import" href="../../polymer/polymer-element.html">
<!--<link rel="import" href="../../polymer/lib/elements/dom-if.html">-->
<!--<link rel="import" href="../../polymer/lib/elements/dom-repeat.html">-->
<link rel="import" href="../../paper-input/paper-input.html">
<link rel="import" href="../../paper-checkbox/paper-checkbox.html">

<!--
`ui-fc-wrapper`


@demo demo/index.html
-->

<dom-module id="ui-fc-wrapper">
  <template>
    <style>
      :host {
        display: inline-block;
      }
    </style>
  </template>
  <script>
    /** @polymerElement */
    class UiFcWrapper extends Polymer.Element {
      static get is() {
        return 'ui-fc-wrapper';
      }

      static get properties() {
        return {
          _el: Object,
          value: {
            notify: true,
            observer: '_valueChanged'
          },
          schema: Object
        };
      }

      connectedCallback() {
        super.connectedCallback();

        this._changeHandler = this._changeHandler.bind(this);

        const {widget, type, label} = this.schema;

        let el;

        if (widget) {
          el = document.createElement(widget);
          el.label = label;
        } else {
          if (type === 'string') {
            el = document.createElement('paper-input');
            el.type = 'text';
            el.label = label;
          } else if (type === 'number') {
            el = document.createElement('paper-input');
            el.type = 'number';
            el.label = label;
          } else if (type === 'boolean') {
            el = document.createElement('paper-checkbox');
            el.innerText = label;
          } else {
            console.warn(`Unexpected schema type: "${type}"`)
          }
        }

        if (el) {
          this._el = el;
          this.root.appendChild(el);
          el.addEventListener('change', this._changeHandler);
          el.addEventListener('input', this._changeHandler);
        }
      }

      _changeHandler(e) {
        e.stopPropagation();
        const {widget, type} = this.schema;
        const {checked, value} = this._el;
        this.value = !widget && type === 'boolean' ? checked : value;
        this.dispatchEvent(new CustomEvent('change', {detail: {value: this.value}}));
      }

      _valueChanged(e) {
        const {widget, type} = this.schema;
        this._el[!widget && type === 'boolean' ? 'checked' : 'value'] = this.value;
      }

    }

    window.customElements.define(UiFcWrapper.is, UiFcWrapper);
  </script>
</dom-module>
